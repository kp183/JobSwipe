generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String?
  role      UserRole @default(CANDIDATE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Profile data
  candidate Candidate?
  company   Company?

  @@map("users")
}

model Candidate {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Basic info
  firstName   String
  lastName    String
  phone       String?
  location    String?
  profilePic  String?
  bio         String?
  
  // Career info
  title           String?
  experienceLevel ExperienceLevel @default(ENTRY)
  expectedSalary  Int?
  preferredRoles  String[] // JSON array of role types
  skills          String[] // JSON array of skills
  
  // Education
  education Education[]
  
  // Experience
  experience WorkExperience[]
  
  // Projects
  projects Project[]
  
  // Job interactions
  swipes        JobSwipe[]
  applications  Application[]
  interviews    Interview[]
  
  // AI data
  resumeData    Json? // AI-generated resume templates
  skillAnalysis Json? // AI skill gap analysis
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("candidates")
}

model Company {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  description String?
  website     String?
  logo        String?
  industry    String?
  size        CompanySize?
  location    String?

  jobs         Job[]
  applications Application[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("companies")
}

model Job {
  id        String @id @default(cuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  title       String
  description String
  requirements String[]
  skills      String[]
  location    String?
  remote      Boolean @default(false)
  type        JobType @default(FULL_TIME)
  
  salaryMin   Int?
  salaryMax   Int?
  currency    String @default("USD")
  
  experienceLevel ExperienceLevel @default(ENTRY)
  
  isActive    Boolean @default(true)
  
  // Job interactions
  swipes       JobSwipe[]
  applications Application[]
  
  // AI matching data
  aiMatchCriteria Json? // AI matching parameters
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("jobs")
}

model JobSwipe {
  id          String @id @default(cuid())
  candidateId String
  jobId       String
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job         Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  direction   SwipeDirection
  matchScore  Float? // AI match score
  
  createdAt DateTime @default(now())

  @@unique([candidateId, jobId])
  @@map("job_swipes")
}

model Application {
  id          String @id @default(cuid())
  candidateId String
  jobId       String
  companyId   String
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job         Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  company     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  status ApplicationStatus @default(PENDING)
  
  // AI-generated content
  resume      String? // AI-generated resume
  coverLetter String? // AI-generated cover letter
  
  // Screening
  screeningScore Float?
  screeningData  Json?
  
  interviews Interview[]
  
  appliedAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([candidateId, jobId])
  @@map("applications")
}

model Interview {
  id            String @id @default(cuid())
  applicationId String
  candidateId   String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  candidate     Candidate   @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  type          InterviewType @default(AI_SCREENING)
  status        InterviewStatus @default(SCHEDULED)
  
  scheduledAt   DateTime?
  completedAt   DateTime?
  
  // AI interview data
  questions     Json? // Interview questions
  responses     Json? // Candidate responses
  aiScore       Float?
  aiAnalysis    Json? // AI evaluation
  
  // Video/audio recordings
  recordingUrl  String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("interviews")
}

model Education {
  id          String @id @default(cuid())
  candidateId String
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  institution String
  degree      String
  field       String?
  startDate   DateTime
  endDate     DateTime?
  gpa         Float?
  
  createdAt DateTime @default(now())

  @@map("education")
}

model WorkExperience {
  id          String @id @default(cuid())
  candidateId String
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  company     String
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime?
  current     Boolean @default(false)
  
  createdAt DateTime @default(now())

  @@map("work_experience")
}

model Project {
  id          String @id @default(cuid())
  candidateId String
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  name        String
  description String?
  technologies String[]
  url         String?
  githubUrl   String?
  
  createdAt DateTime @default(now())

  @@map("projects")
}

// Enums
enum UserRole {
  CANDIDATE
  COMPANY
  ADMIN
}

enum ExperienceLevel {
  ENTRY
  JUNIOR
  MID
  SENIOR
  LEAD
  EXECUTIVE
}

enum CompanySize {
  STARTUP
  SMALL
  MEDIUM
  LARGE
  ENTERPRISE
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum SwipeDirection {
  LEFT
  RIGHT
}

enum ApplicationStatus {
  PENDING
  SCREENING
  INTERVIEWING
  OFFERED
  REJECTED
  ACCEPTED
  WITHDRAWN
}

enum InterviewType {
  AI_SCREENING
  TECHNICAL
  BEHAVIORAL
  FINAL
}

enum InterviewStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}