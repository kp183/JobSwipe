{% extends "base.html" %}

{% block title %}Error - Skill Gap Analyzer{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto text-center py-12">
    <div class="bg-white rounded-xl shadow-sm p-8">
        <!-- Error Icon -->
        <div class="bg-danger-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-exclamation-triangle text-danger-600 text-3xl"></i>
        </div>
        
        <!-- Error Message -->
        <h1 class="text-3xl font-bold text-gray-900 mb-4">Oops! Something went wrong</h1>
        
        {% if message %}
        <p class="text-lg text-gray-600 mb-6">{{ message }}</p>
        {% else %}
        <p class="text-lg text-gray-600 mb-6">
            We encountered an unexpected error while processing your request. 
            Please try again or contact support if the problem persists.
        </p>
        {% endif %}
        
        <!-- Action Buttons -->
        <div class="space-y-4">
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="history.back()" 
                        class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Go Back
                </button>
                <a href="/" 
                   class="bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700 transition-colors">
                    <i class="fas fa-home mr-2"></i>
                    Home Page
                </a>
                <a href="/analyze" 
                   class="bg-success-600 text-white px-6 py-3 rounded-lg hover:bg-success-700 transition-colors">
                    <i class="fas fa-search mr-2"></i>
                    Try Analysis
                </a>
            </div>
            
            <!-- Refresh Button -->
            <button onclick="window.location.reload()" 
                    class="text-primary-600 hover:text-primary-700 underline">
                <i class="fas fa-refresh mr-1"></i>
                Refresh Page
            </button>
        </div>
        
        <!-- Help Section -->
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">Need Help?</h3>
            <div class="text-sm text-gray-600 space-y-2">
                <p>If you continue to experience issues, try these steps:</p>
                <ul class="list-disc list-inside space-y-1 text-left max-w-md mx-auto">
                    <li>Check your internet connection</li>
                    <li>Clear your browser cache and cookies</li>
                    <li>Try using a different browser</li>
                    <li>Disable browser extensions temporarily</li>
                </ul>
            </div>
        </div>
        
        <!-- Contact Information -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <p class="text-sm text-gray-600">
                Still having trouble? 
                <a href="mailto:support@jobswipe.com" class="text-primary-600 hover:text-primary-700 underline">
                    Contact our support team
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Auto-retry functionality for temporary errors
    let retryCount = 0;
    const maxRetries = 3;
    
    function autoRetry() {
        if (retryCount < maxRetries) {
            retryCount++;
            showToast(`Retrying... (${retryCount}/${maxRetries})`, 'info');
            
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        }
    }
    
    // Check if this is a temporary error (you could pass this from the backend)
    const isTemporaryError = {{ 'true' if message and 'timeout' in message.lower() else 'false' }};
    
    if (isTemporaryError) {
        setTimeout(autoRetry, 3000);
    }
    
    // Error reporting (in a real app, you'd send this to your error tracking service)
    function reportError() {
        const errorData = {
            url: window.location.href,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            message: '{{ message|default("Unknown error") }}'
        };
        
        console.log('Error reported:', errorData);
        showToast('Error report sent. Thank you!', 'success');
    }
    
    // Add error reporting button if needed
    {% if not message or 'not found' not in message.lower() %}
    document.addEventListener('DOMContentLoaded', () => {
        const helpSection = document.querySelector('.mt-8.pt-6');
        if (helpSection) {
            const reportButton = document.createElement('button');
            reportButton.className = 'mt-4 text-sm text-primary-600 hover:text-primary-700 underline';
            reportButton.innerHTML = '<i class="fas fa-bug mr-1"></i>Report this error';
            reportButton.onclick = reportError;
            helpSection.appendChild(reportButton);
        }
    });
    {% endif %}
</script>
{% endblock %}